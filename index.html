<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Rafi Isnanto Syahlefi</title>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #020617;
            --text-color: #e2e8f0;
            --text-color-muted: #94a3b8;
            --accent-color: #22d3ee;
            --accent-glow: rgba(34, 211, 238, 0.4);
            --card-bg: rgba(15, 23, 42, 0.6);
            --card-border: rgba(51, 65, 85, 0.5);
            --navbar-bg: rgba(2, 6, 23, 0.75);
        }
        [data-theme="light"] {
            --bg-color: #f1f5f9;
            --text-color: #1e293b;
            --text-color-muted: #475569;
            --accent-color: #0891b2;
            --accent-glow: rgba(14, 165, 233, 0.4);
            --card-bg: rgba(255, 255, 255, 0.6);
            --card-border: rgba(203, 213, 225, 0.8);
            --navbar-bg: rgba(241, 245, 249, 0.75);
        }
        html { 
            scroll-behavior: smooth;
            scroll-padding-top: 100px;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s, color 0.5s;
            overflow-x: hidden;
        }
        body::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        #background-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -10;
        }
        .section {
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
            padding: 8rem 2rem 4rem 2rem;
        }
        .nav-link.active::after, .nav-link:hover::after { width: 100%; }
        .nav-link { position: relative; }
        .nav-link::after {
            content: ''; position: absolute; width: 0; height: 2px; bottom: -4px;
            left: 50%; transform: translateX(-50%);
            background-color: var(--accent-color);
            transition: width 0.3s ease-in-out, background-color 0.5s;
        }
        .gradient-text { color: var(--accent-color); transition: color 0.5s; }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.5s, border-color 0.5s;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px -10px var(--accent-glow);
        }
        .contact-form {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 1rem;
            padding: 2.5rem;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.2);
        }
        .contact-form input, .contact-form textarea {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        .contact-form input:focus, .contact-form textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-glow);
            outline: none;
        }
        .contact-form input::placeholder, .contact-form textarea::placeholder {
            color: var(--text-color-muted);
        }
        .contact-form button {
            background-color: var(--accent-color);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .contact-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px -5px var(--accent-glow);
        }
        #three-canvas-container {
            width: 100%; height: 350px; max-width: 350px; cursor: grab;
        }
        #three-canvas-container:active {
            cursor: grabbing;
        }

        /* Chatbot Styles */
        #chat-launcher {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 5px 15px -5px var(--accent-glow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        #chat-launcher:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px -5px var(--accent-glow);
        }
        #chat-window {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            width: 90%;
            max-width: 400px;
            height: 70%;
            max-height: 600px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(12px);
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.4);
            z-index: 999;
            opacity: 0;
            transform: translateY(20px);
            visibility: hidden;
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
        }
        #chat-window.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        #chat-header {
            padding: 1rem;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-message {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 80%;
            line-height: 1.5;
        }
        .user-message {
            background-color: var(--accent-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .bot-message {
            background-color: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        .typing-indicator {
            align-self: flex-start;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-color-muted);
            animation: bounce 1.3s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.3s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        #chat-form {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--card-border);
        }
        #chat-input {
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--text-color);
            border-radius: 9999px;
            padding: 0.75rem 1rem;
            margin-right: 0.5rem;
            outline: none;
        }
        
        @media (max-width: 768px) {
            .contact-form { padding: 1.5rem; margin: 0 1rem; }
            .section { padding: 6rem 1rem 2rem 1rem; }
            #chat-window { bottom: 6rem; right: 1rem; width: calc(100% - 2rem); }
            #chat-launcher { bottom: 1rem; right: 1rem; }
        }
    </style>
</head>
<body data-theme="dark">

    <canvas id="background-canvas"></canvas>

    <header class="fixed top-0 left-0 w-full z-50 p-4">
        <div class="container mx-auto flex justify-center items-center relative bg-[var(--navbar-bg)] backdrop-blur-sm p-3 px-4 md:px-6 rounded-full border border-[var(--card-border)] transition-colors duration-500">
            <a href="#home" class="absolute left-6 nav-link-header text-xl font-bold gradient-text">Rafi I.S.</a>
            <nav class="desktop-nav flex items-center space-x-3 sm:space-x-4 md:space-x-6 text-[var(--text-color-muted)] text-sm">
                <a href="#home" class="nav-link nav-link-header transition-colors duration-300 hover:text-[var(--text-color)]">Home</a>
                <a href="#about" class="nav-link nav-link-header transition-colors duration-300 hover:text-[var(--text-color)]">About</a>
                <a href="#skills" class="nav-link nav-link-header transition-colors duration-300 hover:text-[var(--text-color)]">Skills</a>
                <a href="#projects" class="nav-link nav-link-header transition-colors duration-300 hover:text-[var(--text-color)]">Projects</a>
                <a href="#contact" class="nav-link nav-link-header transition-colors duration-300 hover:text-[var(--text-color)]">Contact</a>
            </nav>
            <button id="theme-toggle" class="absolute right-6 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors flex-shrink-0">
                <i id="theme-icon" class="fas fa-moon"></i>
            </button>
        </div>
    </header>
    
    <main>
        <!-- Home Section -->
        <section id="home" class="section text-center">
            <img 
                src="WhatsApp Image 2025-06-16 at 00.50.46_a254b389.jpg" 
                alt="Foto Profil Rafi" 
                class="gsap-reveal-img w-32 h-32 rounded-full mx-auto mb-6 border-4 border-[var(--accent-color)] shadow-lg object-cover"
                onerror="this.onerror=null; this.src='https://placehold.co/120x120/0a0a0a/e5e5e5?text=Foto';"
            >
            <h1 class="gsap-reveal-text text-4xl md:text-5xl font-extrabold mb-2">Rafi Isnanto Syahlefi</h1>
            <p class="gsap-reveal-text text-xl md:text-2xl font-light text-[var(--text-color-muted)]">informatics engineering student</p>
            <p class="gsap-reveal-text max-w-2xl mx-auto mt-4 text-[var(--text-color-muted)]">
                Seorang mahasiswa yang bersemangat dalam pengembangan web, mengeksplorasi teknologi modern untuk menciptakan aplikasi yang intuitif dan menarik.
            </p>
        </section>

        <!-- About Section -->
        <section id="about" class="section">
            <div class="container mx-auto grid md:grid-cols-2 gap-16 items-center">
                <div class="gsap-reveal-content">
                    <h2 class="gsap-reveal-title text-3xl md:text-4xl font-bold mb-4">Tentang Saya</h2>
                    <p class="text-[var(--text-color-muted)] mb-4 gsap-about-text">
                        Halo! Saya Rafi, seorang mahasiswa Teknik Informatika dengan minat besar pada desain antarmuka (UI/UX) dan pengembangan front-end. Saya suka belajar hal baru dan menerapkannya dalam proyek-proyek kreatif.
                    </p>
                    <p class="text-[var(--text-color-muted)] gsap-about-text">
                        Saya percaya bahwa desain yang baik dan interaktivitas dapat membuat web lebih hidup.
                    </p>
                </div>
                <div class="gsap-reveal-crystal flex justify-center items-center">
                    <div id="three-canvas-container"></div>
                </div>
            </div>
        </section>
        
        <!-- Skills Section -->
        <section id="skills" class="section">
             <div class="container mx-auto text-center">
                <h2 class="gsap-reveal-title text-3xl md:text-4xl font-bold mb-12">Keahlian Saya</h2>
                <div class="max-w-4xl mx-auto flex flex-wrap justify-center items-center gap-8">
                    <div class="card skill-item rounded-2xl p-6 flex flex-col items-center justify-center gap-y-4 w-40 h-40">
                        <img src="https://www.vectorlogo.zone/logos/w3_html5/w3_html5-icon.svg" alt="HTML5" class="w-14 h-14">
                        <span class="font-semibold text-lg">HTML5</span>
                    </div>
                    <div class="card skill-item rounded-2xl p-6 flex flex-col items-center justify-center gap-y-4 w-40 h-40">
                        <img src="https://www.vectorlogo.zone/logos/w3_css/w3_css-icon.svg" alt="CSS3" class="w-14 h-14">
                        <span class="font-semibold text-lg">CSS3</span>
                    </div>
                    <div class="card skill-item rounded-2xl p-6 flex flex-col items-center justify-center gap-y-4 w-40 h-40">
                        <img src="https://www.vectorlogo.zone/logos/javascript/javascript-icon.svg" alt="JavaScript" class="w-14 h-14">
                        <span class="font-semibold text-lg">JavaScript</span>
                    </div>
                    <div class="card skill-item rounded-2xl p-6 flex flex-col items-center justify-center gap-y-4 w-40 h-40">
                        <img src="https://www.vectorlogo.zone/logos/tailwindcss/tailwindcss-icon.svg" alt="Tailwind CSS" class="w-14 h-14">
                        <span class="font-semibold text-lg">Tailwind CSS</span>
                    </div>
                    <div class="card skill-item rounded-2xl p-6 flex flex-col items-center justify-center gap-y-4 w-40 h-40">
                        <img src="https://www.vectorlogo.zone/logos/figma/figma-icon.svg" alt="Figma" class="w-14 h-14">
                        <span class="font-semibold text-lg">Figma</span>
                    </div>
                </div>
             </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="section">
             <div class="container mx-auto text-center">
                <h2 class="gsap-reveal-title text-3xl md:text-4xl font-bold mb-12">Proyek Saya</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card project-card rounded-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/0f172a/94a3b8?text=Platform+E-commerce" alt="Project E-commerce" class="w-full h-48 object-cover">
                        <div class="p-6 text-left">
                            <h3 class="text-xl font-bold mb-2 text-[var(--accent-color)]">Platform E-commerce</h3>
                            <p class="text-[var(--text-color-muted)] mb-4">Platform belanja online dengan fitur lengkap.</p>
                            <div class="flex gap-3">
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-[var(--accent-color)] text-slate-900 dark:text-white px-4 py-2 rounded-md hover:brightness-90 transition-all text-sm">
                                    <i class="fas fa-external-link-alt mr-2"></i>Demo
                                </a>
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-white/10 text-[var(--text-color)] px-4 py-2 rounded-md hover:bg-white/20 transition-colors text-sm">
                                    <i class="fab fa-github mr-2"></i>Code
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card project-card rounded-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/0f172a/94a3b8?text=Aplikasi+Manajemen+Tugas" alt="Project To-Do App" class="w-full h-48 object-cover">
                         <div class="p-6 text-left">
                            <h3 class="text-xl font-bold mb-2 text-[var(--accent-color)]">Aplikasi Manajemen Tugas</h3>
                            <p class="text-[var(--text-color-muted)] mb-4">Aplikasi untuk produktivitas dan manajemen tugas harian.</p>
                            <div class="flex gap-3">
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-[var(--accent-color)] text-slate-900 dark:text-white px-4 py-2 rounded-md hover:brightness-90 transition-all text-sm">
                                    <i class="fas fa-external-link-alt mr-2"></i>Demo
                                </a>
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-white/10 text-[var(--text-color)] px-4 py-2 rounded-md hover:bg-white/20 transition-colors text-sm">
                                    <i class="fab fa-github mr-2"></i>Code
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card project-card rounded-xl overflow-hidden">
                        <img src="https://placehold.co/600x400/0f172a/94a3b8?text=Dashboard+Cuaca" alt="Project Weather App" class="w-full h-48 object-cover">
                         <div class="p-6 text-left">
                            <h3 class="text-xl font-bold mb-2 text-[var(--accent-color)]">Dashboard Cuaca</h3>
                            <p class="text-[var(--text-color-muted)] mb-4">Visualisasi data cuaca real-time dari berbagai kota.</p>
                            <div class="flex gap-3">
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-[var(--accent-color)] text-slate-900 dark:text-white px-4 py-2 rounded-md hover:brightness-90 transition-all text-sm">
                                    <i class="fas fa-external-link-alt mr-2"></i>Demo
                                </a>
                                <a href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-white/10 text-[var(--text-color)] px-4 py-2 rounded-md hover:bg-white/20 transition-colors text-sm">
                                    <i class="fab fa-github mr-2"></i>Code
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="section">
            <div class="container mx-auto text-center contact-wrapper flex flex-col items-center">
                <h2 class="gsap-reveal-title text-3xl md:text-4xl font-bold mb-6">Hubungi Saya</h2>
                <p class="text-[var(--text-color-muted)] mb-8 max-w-xl mx-auto gsap-reveal-form-item text-lg">
                    Punya pertanyaan atau ingin bekerja sama? Kirim pesan di bawah atau tanyakan pada asisten AI saya di pojok kanan bawah!
                </p>
                
                <form id="contact-form" class="contact-form gsap-reveal-form" action="#" method="POST">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="gsap-reveal-form-item">
                            <input id="contact-name" type="text" placeholder="Nama Anda" class="w-full rounded-lg p-3" required>
                        </div>
                        <div class="gsap-reveal-form-item">
                            <input id="contact-email" type="email" placeholder="Email Anda" class="w-full rounded-lg p-3" required>
                        </div>
                    </div>
                    <div class="my-6 gsap-reveal-form-item">
                         <input id="contact-subject" type="text" placeholder="Subjek Pesan" class="w-full rounded-lg p-3" required>
                    </div>
                    <div class="mb-6 gsap-reveal-form-item">
                        <textarea id="contact-message" placeholder="Pesan Anda" rows="5" class="w-full rounded-lg p-3" required></textarea>
                    </div>
                    <div class="gsap-reveal-form-item">
                        <button type="submit" class="w-full font-bold py-3 px-8 rounded-lg flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i> Kirim Pesan
                        </button>
                    </div>
                </form>
                
                <div class="mt-12 gsap-reveal-form-item">
                    <h3 class="text-xl font-semibold mb-4">Atau hubungi saya melalui:</h3>
                    <div class="flex justify-center gap-6">
                        <a href="https://wa.me/6287847320942" target="_blank" class="text-2xl hover:text-[var(--accent-color)] transition-colors" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        <a href="https://www.linkedin.com/in/rafi-isnanto-syahlefi-63593336b/" target="_blank" class="text-2xl hover:text-[var(--accent-color)] transition-colors" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                        <a href="https://github.com/Ravy1310" target="_blank" class="text-2xl hover:text-[var(--accent-color)] transition-colors" title="GitHub"><i class="fab fa-github"></i></a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center p-4 text-[var(--text-color-muted)] text-sm">
        Didesain dengan <span class="text-[var(--accent-color)]">&hearts;</span> oleh Rafi Isnanto Syahlefi &copy; 2025
    </footer>

    <!-- Chatbot Launcher -->
    <button id="chat-launcher" title="Tanya Asisten AI">
        <i class="fas fa-robot"></i>
    </button>

    <!-- Chatbot Window -->
    <div id="chat-window">
        <div id="chat-header">
            <h3 class="font-bold text-lg">Asisten AI Rafi</h3>
            <button id="chat-close-btn" class="text-2xl">&times;</button>
        </div>
        <div id="chat-messages">
            <!-- Messages will be injected here -->
        </div>
        <form id="chat-form">
            <input id="chat-input" type="text" placeholder="Ketik pesan Anda..." autocomplete="off">
            <button type="submit" class="bg-[var(--accent-color)] text-white w-12 h-12 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollToPlugin.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        // --- Theme Toggle ---
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const body = document.body;
        const applyTheme = (theme) => {
            body.dataset.theme = theme;
            localStorage.setItem('theme', theme);
            // Toggle tailwind dark class
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            themeIcon.className = theme === 'light' ? 'fas fa-sun' : 'fas fa-moon';
            window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme } }));
        };
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
        themeToggle.addEventListener('click', () => {
            applyTheme(body.dataset.theme === 'dark' ? 'light' : 'dark');
        });
        
        // --- Smooth Nav Scrolling ---
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (targetId.length <= 1) return;
                e.preventDefault();
                const targetSection = document.querySelector(targetId);
                if (!targetSection) return;
                const navbarHeight = document.querySelector('header').offsetHeight;
                const targetPosition = targetId === '#home' ? 0 : targetSection.offsetTop - navbarHeight;
                gsap.to(window, { duration: 0.7, scrollTo: { y: targetPosition, autoKill: false }, ease: "power3.inOut" });
            });
        });

        // --- Background Starfield Canvas ---
        const bgCanvas = document.getElementById('background-canvas');
        if (bgCanvas) {
            const bgCtx = bgCanvas.getContext('2d');
            let stars = [];
            function setCanvasSize() {
                bgCanvas.width = window.innerWidth;
                bgCanvas.height = window.innerHeight;
            }
            class Star {
                constructor(x, y, z, theme) {
                    this.x = x; this.y = y; this.z = z;
                    this.radius = 1 + (Math.random() * 1.5);
                    this.updateColor(theme);
                }
                updateColor(theme) {
                    this.color = theme === 'dark' ? `rgba(226, 232, 240, ${0.5 + Math.random() * 0.5})` : `rgba(100, 116, 139, ${0.5 + Math.random() * 0.5})`;
                }
                draw(ctx) {
                    const sx = (this.x - bgCanvas.width / 2) * (bgCanvas.width / this.z) + bgCanvas.width / 2;
                    const sy = (this.y - bgCanvas.height / 2) * (bgCanvas.width / this.z) + bgCanvas.height / 2;
                    if (sx < 0 || sx > bgCanvas.width || sy < 0 || sy > bgCanvas.height) { this.reset(); }
                    const r = this.radius * (bgCanvas.width / this.z);
                    ctx.beginPath();
                    ctx.arc(sx, sy, r, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                reset() {
                    this.z = bgCanvas.width;
                    this.x = Math.random() * bgCanvas.width;
                    this.y = Math.random() * bgCanvas.height;
                }
                update(ctx) {
                    this.z -= 0.6;
                    if (this.z <= 0) { this.reset(); }
                    this.draw(ctx);
                }
            }
            function initStars() {
                stars = [];
                const currentTheme = body.dataset.theme;
                for (let i = 0; i < 250; i++) {
                    stars.push(new Star(Math.random() * bgCanvas.width, Math.random() * bgCanvas.height, Math.random() * bgCanvas.width, currentTheme));
                }
            }
            function animateStars() {
                requestAnimationFrame(animateStars);
                bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
                stars.forEach(star => star.update(bgCtx));
            }
            setCanvasSize();
            initStars();
            animateStars();
            window.addEventListener('resize', () => { setCanvasSize(); initStars(); });
            window.addEventListener('themeChanged', (e) => { stars.forEach(star => star.updateColor(e.detail.theme)); });
        }
        
        // --- Three.js Crystal Animation (Auto-rotating & Interactive) ---
        const threeContainer = document.getElementById('three-canvas-container');
        if (threeContainer) {
            let scene, camera, renderer, crystal;
            let mousePos = { x: 0, y: 0 };
            let isInteracting = false;
            let interactionTimeout;

            function initThree() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, threeContainer.clientWidth / threeContainer.clientHeight, 0.1, 1000);
                camera.position.z = 2.2;

                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(threeContainer.clientWidth, threeContainer.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                threeContainer.appendChild(renderer.domElement);
                
                const geometry = new THREE.IcosahedronGeometry(1.2, 0);
                const material = new THREE.MeshBasicMaterial({ 
                    color: new THREE.Color(getComputedStyle(document.body).getPropertyValue('--accent-color')), 
                    wireframe: true, 
                    transparent: true, 
                    opacity: 0.8 
                });
                crystal = new THREE.Mesh(geometry, material);
                scene.add(crystal);
                
                threeContainer.addEventListener('mousemove', onMouseMove, false);
                threeContainer.addEventListener('mouseleave', onMouseLeave, false);
                
                animateThree();
            }

            function onMouseMove(event) {
                isInteracting = true;
                clearTimeout(interactionTimeout);
                
                const rect = threeContainer.getBoundingClientRect();
                mousePos.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mousePos.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                interactionTimeout = setTimeout(() => {
                    isInteracting = false;
                }, 2000); // Resume auto-rotation after 2s of inactivity
            }

            function onMouseLeave(event) {
                isInteracting = false;
                clearTimeout(interactionTimeout);
            }

            function animateThree() {
                requestAnimationFrame(animateThree);
                
                if (crystal) {
                    if (isInteracting) {
                         // When interacting, smoothly move towards the mouse position
                        gsap.to(crystal.rotation, {
                            x: -mousePos.y * 0.4,
                            y: mousePos.x * 0.4,
                            duration: 1.5,
                            ease: 'power2.out'
                        });
                    } else {
                        // When not interacting, rotate automatically
                        crystal.rotation.x += 0.0015;
                        crystal.rotation.y += 0.0015;
                    }
                }
                
                renderer.render(scene, camera);
            }
            
            initThree();
            
            window.addEventListener('themeChanged', () => {
                if (crystal) {
                    const newColor = new THREE.Color(getComputedStyle(document.body).getPropertyValue('--accent-color'));
                    crystal.material.color.set(newColor);
                }
            });

            window.addEventListener('resize', () => {
                 if(camera && renderer && threeContainer) {
                    camera.aspect = threeContainer.clientWidth / threeContainer.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(threeContainer.clientWidth, threeContainer.clientHeight);
                }
            });
        }


        // --- GSAP Scroll Animations ---
        // Home section animations
        gsap.from('.gsap-reveal-img', { 
            scrollTrigger: { trigger: '#home', start: 'top 70%', toggleActions: 'play none none reverse' }, 
            opacity: 0, scale: 0.5, duration: 1.2, ease: 'elastic.out(1, 0.5)' 
        });
        
        gsap.from('.gsap-reveal-text', { 
            scrollTrigger: { trigger: '#home', start: 'top 70%', toggleActions: 'play none none reverse' }, 
            opacity: 0, y: 30, duration: 1, stagger: 0.15, ease: 'power3.out' 
        });
        
        // General Section title animation
        gsap.utils.toArray('.gsap-reveal-title').forEach(el => {
            gsap.from(el, {
                scrollTrigger: { trigger: el, start: 'top 90%', toggleActions: 'play none none reverse' },
                opacity: 0, y: 50, skewX: -10, duration: 0.8, ease: 'power3.out'
            });
        });
        
        // About Section Animation
        gsap.from('.gsap-about-text', {
            scrollTrigger: { trigger: '.gsap-reveal-content', start: 'top 85%', toggleActions: 'play none none reverse'},
            opacity: 0, y: 40, stagger: 0.2, duration: 0.8, ease: 'power3.out'
        });

        gsap.from('.gsap-reveal-crystal', { 
            scrollTrigger: { trigger: '.gsap-reveal-crystal', start: 'top 85%', toggleActions: 'play none none reverse'}, 
            opacity: 0, x: 50, duration: 1, ease: 'power3.out' 
        });
        
        // Skills Section Animation
        gsap.from('.skill-item', { 
            scrollTrigger: { trigger: '#skills', start: 'top 80%', toggleActions: 'play none none reverse' }, 
            opacity: 0, y: 40, stagger: 0.1, duration: 0.7, ease: 'power3.out' 
        });
        
        // Projects Section Animation
        gsap.from('.project-card', { 
            scrollTrigger: { trigger: '#projects', start: 'top 80%', toggleActions: 'play none none reverse' }, 
            opacity: 0, y: 40, stagger: 0.15, duration: 0.8, ease: 'power3.out' 
        });
        
        // Contact Form Animation
        gsap.from('.contact-form', {
            scrollTrigger: { trigger: '.contact-wrapper', start: 'top 80%', toggleActions: 'play none none reverse' },
            y: 50, opacity: 0, duration: 0.8, ease: 'power2.out'
        });
        
        gsap.from('.gsap-reveal-form-item', { 
            scrollTrigger: { trigger: '.contact-form', start: 'top 90%', toggleActions: 'play none none reverse' }, 
            y: 30, opacity: 0, stagger: 0.1, duration: 0.6, ease: 'power2.out' 
        });

        // --- Chatbot Logic ---
        const chatLauncher = document.getElementById('chat-launcher');
        const chatWindow = document.getElementById('chat-window');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');

        const chatHistory = [];
        const personaPrompt = `Anda adalah Asisten AI Rafi, chatbot yang ramah dan sangat membantu di situs portofolio Rafi Isnanto Syahlefi. Informasi tentang Rafi: Dia adalah seorang mahasiswa Teknik Informatika yang bersemangat dalam pengembangan web dan UI/UX. Keahliannya meliputi HTML, CSS, JavaScript, Tailwind CSS, dan Figma. Proyek-proyeknya termasuk platform e-commerce, aplikasi manajemen tugas, dan dashboard cuaca. Tugas Anda adalah: 1. Menjawab pertanyaan pengunjung tentang Rafi berdasarkan informasi ini. 2. Membantu pengunjung menyusun pesan kontak untuk Rafi jika mereka memintanya. 3. Selalu berkomunikasi dalam bahasa Indonesia yang sopan, profesional, dan bersahabat. Mulailah percakapan dengan menyapa dan menawarkan bantuan.`;

        const addMessage = (sender, message) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', `${sender}-message`);
            messageElement.innerHTML = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };

        const addTypingIndicator = () => {
            const typingElement = document.createElement('div');
            typingElement.classList.add('chat-message', 'bot-message', 'typing-indicator');
            typingElement.innerHTML = `<span></span><span></span><span></span>`;
            chatMessages.appendChild(typingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingElement;
        }

        const getBotResponse = async () => {
            const typingIndicator = addTypingIndicator();
            try {
                const payload = {
                    contents: chatHistory,
                    system_instruction: { parts: [{ text: personaPrompt }] },
                };
                
                const apiKey = "AIzaSyAC_7nBtJFbE_D2tiGQH5UtOAxLaWSbWr0"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorBody = await response.json();
                    console.error("API Error Response:", errorBody);
                    throw new Error(`API Error: ${response.status} - ${errorBody.error?.message || 'Unknown error'}`);
                }
                
                const result = await response.json();
                chatMessages.removeChild(typingIndicator);

                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content?.parts[0]?.text) {
                    const botMessage = result.candidates[0].content.parts[0].text;
                    addMessage('bot', botMessage);
                    chatHistory.push({ role: 'model', parts: [{ text: botMessage }] });
                } else {
                    addMessage('bot', 'Maaf, saya tidak menerima respons yang valid. Coba lagi nanti.');
                }
            } catch (error) {
                console.error("Chatbot Error:", error);
                chatMessages.removeChild(typingIndicator);
                addMessage('bot', 'Maaf, sepertinya ada masalah. Silakan coba lagi nanti.');
            }
        };
        
        // Event Listeners
        chatLauncher.addEventListener('click', () => {
            chatWindow.classList.toggle('show');
            if (chatWindow.classList.contains('show') && chatMessages.children.length === 0) {
                 addMessage('bot', 'Halo! Saya Asisten AI Rafi. Ada yang bisa saya bantu? Anda bisa bertanya tentang keahlian, proyek, atau meminta bantuan untuk menulis pesan kontak.');
            }
        });

        chatCloseBtn.addEventListener('click', () => chatWindow.classList.remove('show'));

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;

            addMessage('user', userInput);
            chatHistory.push({ role: 'user', parts: [{ text: userInput }] });
            chatInput.value = '';

            getBotResponse();
        });

        // Active nav link on scroll
        gsap.utils.toArray('section').forEach(section => {
            ScrollTrigger.create({
                trigger: section,
                start: "top 60%", 
                end: "bottom 40%",
                onToggle: self => self.isActive && setActive(section.id)
            });
        });

        function setActive(id) {
            document.querySelectorAll('.nav-link-header').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link-header[href="#${id}"]`);
            if (activeLink) activeLink.classList.add('active');
        }
    });
    </script>
</body>
</html>
